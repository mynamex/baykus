<div class="row">
    <div class="col-xl-6">
        <div class="card">
            <div class="card-header border-0">
                <div class="row align-items-center">
                    <div class="col">
                        <h3 class="mb-0 text-white" >Bloklar</h3>
                    </div>
                    <div class="col text-right">

                    </div>
                </div>
            </div>
            <div class="table-responsive">
                <!-- Projects table -->
                <div class="col">
                    <div id="jsGridBlocks"></div>
                </div>

            </div>
        </div>
    </div>

    <div class="col-xl-6">
        <div class="card">
            <div class="card-header border-0">
                <div class="row align-items-center">
                    <div class="col">
                         <span class="d-none d-md-block text-white" id="selectedBlockLabel"></span>

                    </div>
                    <div class="col text-right">

                         <h3 class="mb-0">Daireler</h3>
                    </div>
                </div>
            </div>
            <div class="table-responsive">
                <!-- Projects table -->
                <div class="col" id="daireContainer">
                     {% include 'staff/customer_temp/tables/table-daires.html' %}
                    <div id="jsGridDaires"></div>
                </div>

            </div>
        </div>
    </div>
</div>






{% block javascripts %}

    <script>
        $(document).ready(function () {

            $("#jsGridBlocks").jsGrid({
                bgColor: "red",
                width: "100%",
                height: "360px",
                inserting: true,
                //filtering: true,
                selecting: true,
                editing: true,
                sorting: true,
                autoload: true,
                   paging: true,
                {#//  paging: true,#}
                controller: {
                    loadData: function () {
                        let d = $.Deferred();
                        $.ajax({
                            method: 'GET', dataType: "json",
                            url:"{% url 'staff_me:blocks_view' %}",

                            data: {
                                "account_id": {{ customer.pk }},
                                "csrfmiddlewaretoken": '{{ csrf_token }}'
                            },
                        }).done(function (response) {

                            if (response.d_blocks) {
                                d.resolve(response.d_blocks);
                            }
                        });

                        return d.promise();
                    }
                },

                onItemInserting: function (args) {
                    $.ajax({
                        method: 'POST', dataType: "json", async:false,
                        url:"{% url 'staff_me:blocks_view' %}",
                        data: {
                            "in_go":"create",
                            "account_id": {{ customer.pk }},
                            "block_name": args.item.name,
                            "is_active": args.item.is_active,
                            "csrfmiddlewaretoken": '{{ csrf_token }}'
                        },

                    }).done(function (response) {
                        if (response.result) {

                            args.item.id = response.block_id
                            args.item.is_active = true
                              $("#jsGridBlocks").jsGrid("refresh");
                            MyToastSuccess("Yeni blok yaratıldı")
                        } else {
                            if (response.status_message)
                                MyToastWarn(response.status_message);

                            args.cancel = true
                        }
                    });
                },
                onItemUpdating: function (args) {
                    $.ajax({
                        method: 'POST', dataType: "json", async:false,
                        url:"{% url 'staff_me:blocks_view' %}",
                        data: {
                            "in_go":"update",
                            "account_id": {{ customer.pk }},
                            "block_name": args.item.name,
                            "block_id": args.item.id,
                            "is_active": args.item.is_active,
                            "csrfmiddlewaretoken": '{{ csrf_token }}'
                        },

                    }).done(function (response) {
                        if (response.result) {
                            MyToastSuccess("Güncelleme Başarılı")
                            $(".jsgrid-edit-mode-button").click()
                        } else {
                            if (response.status_message)
                                MyToastWarn(response.status_message);
                           args.cancel = true
                        }
                    });
                },
                rowClick: function (args) {
                    console.log(args.item.name, "block name")
                    selectedBlokId = args.item.id;
                    console.log(selectedBlokId, "id")
                    if (selectedBlokId > 0) {
                        $("#daireContainer").css("visibility", "visible");
                        $("#selectedBlockLabel").html("Seçilen Blok : " + args.item.name);
                        $("#jsGridDaires").jsGrid("loadData");
                    } else {
                        $("#daireContainer").css("visibility", "hidden");
                    }
                },
                fields: [
                    {name: "id", title: "Id", type: "number", width: 10, visible: false, validate: "required"},
                    {name: "name", title: "Blok", type: "text", width: 50, validate: "required"},
                    {name: "is_active", title: "Durum", type: "checkbox", width: 30},
                    {type: "control", deleteButton: false}]
            });
        });
    </script>


{% endblock javascripts %}

